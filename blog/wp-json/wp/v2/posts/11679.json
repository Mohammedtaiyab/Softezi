{"id":11679,"date":"2016-02-12T19:42:25","date_gmt":"2016-02-12T17:42:25","guid":{"rendered":"https:\/\/stanfy.com\/?p=11679"},"modified":"2019-10-08T17:57:15","modified_gmt":"2019-10-08T14:57:15","slug":"cocoapods-googlemaps-and-github-restrictions","status":"publish","type":"post","link":"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/","title":{"rendered":"Cocoapods, GoogleMaps and Github 100 Mb restrictions"},"content":{"rendered":"<p>On some mobile app projects we\u2019re developing, <a href=\"https:\/\/stanfy.com\/our-work\/category\/ios-services#start-content\" target=\"_blank\" rel=\"noopener noreferrer\">we\u2019re using CocoaPods<\/a>. More than that, in some projects, where we\u2019re using <span style=\"padding: 1px 3px; font-family: monospace, sans-serif; font-size: 0.8em; border-radius: 0.3em; background-color: #f0f0f0;\"><strong>CocoaPods<\/strong><\/span>, we\u2019re adding the Pods directory to the source control. <a href=\"https:\/\/www.dzombak.com\/blog\/2014\/03\/including-pods-in-source-control.html\" target=\"_blank\" rel=\"noopener noreferrer\">There are reasons<\/a> for that. There are a few drawbacks to that approach, but our goal is to be sure that anyone can build a mobile app project right after cloning it.<\/p>\n<p>We\u2019re using Github for the repository and after the latest Google Maps version upgrade, Github started to decline our pushing attempts. This was because some of our files appeared to be more than <a href=\"https:\/\/help.github.com\/articles\/what-is-my-disk-quota\/#file-and-repository-size-limitations\" target=\"_blank\" rel=\"noopener noreferrer\">100Megabytes in size<\/a>.<\/p>\n<p>The problem file was Google Maps framework which was about ~114MB.<\/p>\n<h2>What to do?<\/h2>\n<p>There were a few ways we were thinking about handling this \u201cfeature\u201d:<\/p>\n<ul>\n<li>Stop pushing CocoaPods to the repo.<\/li>\n<li>Stop using Google Maps in the project.<\/li>\n<li>Divide Google Maps into smaller files, and recombine them on the build machine.<\/li>\n<\/ul>\n<h2>Decisions<\/h2>\n<p>When this problem occurred there wasn\u2019t enough time to start experimenting with alternative options. Installing CocoaPods could take a while. On our integration server we were using a clean setup each time, so if we\u2019d decided to set up CocoaPods each time on the server, we would\u2019ve increased build time dramatically.<\/p>\n<p>Also, we weren\u2019t able to just remove Google Maps from the project at that point in time because the deadline was near.<\/p>\n<p>Therefore we decided to leave CocoaPods in the repository, but deal with the big files somehow.<\/p>\n<p>Below you can see our solution to use in iOS app development:<\/p>\n<h2>Solution<\/h2>\n<p>The idea was as simple as it could be \u2013 divide the big file into the smaller ones, and combine small parts in the original file on the build server.<\/p>\n<h3>Splitting up the file<\/h3>\n<p>In order to split the file, we\u2019ve added few lines to our <span style=\"padding: 1px 3px; font-family: monospace, sans-serif; font-size: 0.8em; border-radius: 0.3em; background-color: #f0f0f0;\">Podfile<\/span>:<\/p>\n<pre><code>post_install do |installer_representation|\r\n    puts \"Splitting up Gooogle Framework - It's just too big to be presented in the Github :(\"\r\n    Dir.chdir(\"Pods\/GoogleMaps\/Frameworks\/GoogleMaps.framework\/Versions\/Current\") do\r\n       # Remove previous split files if any\r\n       `rm GoogleMaps_Split_*`\r\n       # Split current framework into smaller parts\r\n       `split -b 30m GoogleMaps GoogleMaps_Split_`\r\n    end\r\nend<\/code><\/pre>\n<p>The solution, as you can see, is pretty straightforward \u2013 each time the pods are being installed, we\u2019re splitting up the framework to smaller 30MB chunks.<\/p>\n<h3>Adding the framework file to <span style=\"padding: 1px 3px; font-family: monospace, sans-serif; font-size: 0.8em; border-radius: 0.3em; background-color: #f0f0f0;\">.gitignore<\/span><\/h3>\n<p>Since we cannot push this file to the repo, we need to remove it from the index and add it to <span style=\"padding: 1px 3px; font-family: monospace, sans-serif; font-size: 0.8em; border-radius: 0.3em; background-color: #f0f0f0;\">.gitignore<\/span>.<\/p>\n<pre class=\"\"># Google Maps is too big to be handled by one file, so this one is generated on build phase from smaller pieces\r\nOurProject\/Pods\/GoogleMaps\/Frameworks\/GoogleMaps.framework\/Versions\/A\/GoogleMaps\r\n<\/pre>\n<h2>Combining chunks in the original file<\/h2>\n<p>Since we\u2019re not using pod install on the build server (that is what this is all about, actually), we need a place where we can combine the file again \u2013 we only have small chunks in the repository. So in our case we\u2019ve added an additional build phase in the xcode project, which looked like this:<\/p>\n<pre class=\"\"># Github doesn't support files bigger than 100M.\r\n# Latest checked GoogleMaps Framework ~ 114M\r\n# We're expecting to have GoogleMaps Framework as a one file or as a number of chunks\r\n\r\nBINARY_FILENAME=GoogleMaps\r\nSPLIT_FILENAME_PREFIX=${BINARY_FILENAME}_Split\r\nGMAPS_FRAMEWORK_DIR=Pods\/GoogleMaps\/Frameworks\/GoogleMaps.framework\/Versions\/Current\r\nGMAPS_FRAMEWORK_FILE=$GMAPS_FRAMEWORK_DIR\/$BINARY_FILENAME\r\n\r\n# Check if we  have Google Maps Framework\r\nif [ ! -f ${GMAPS_FRAMEWORK_FILE} ]; then\r\n    echo \"There's no Google Maps framework at ${GMAPS_FRAMEWORK_FILE}\"\r\n    cd ${GMAPS_FRAMEWORK_DIR}\r\n    #  But we have chunks! ...Probably\r\n    if [ -f ${SPLIT_FILENAME_PREFIX}_aa ]; then\r\n       echo \"Creating file from smaller files with ${SPLIT_FILENAME_PREFIX} prefix\"\r\n       cat ${SPLIT_FILENAME_PREFIX}_* &gt; ${BINARY_FILENAME}\r\n    fi\r\nfi\r\n<\/pre>\n<h2>Profit<\/h2>\n<p>This is how we solved this mobile app development issue. By doing this we bought some time to make a long-term decision about how to handle this issue. Of course it\u2019s just a <a href=\"https:\/\/news.ycombinator.com\/item?id=7663616\" target=\"_blank\" rel=\"noopener noreferrer\">temporary solution<\/a>.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>On some mobile app projects we\u2019re developing, we\u2019re using CocoaPods. More than that, in some projects, where we\u2019re using CocoaPods, we\u2019re adding the Pods directory&#8230;<\/p>\n","protected":false},"author":63,"featured_media":14673,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[1],"tags":[],"yoast_head":"<!-- This site is optimized with the Yoast SEO plugin v14.9 - https:\/\/yoast.com\/wordpress\/plugins\/seo\/ -->\n<meta name=\"description\" content=\"CocoaPods, GoogleMaps, and GitHub restrictions that occur. Learn about our decisions and possible solutions to the issues that might happen in the process.\" \/>\n<meta name=\"robots\" content=\"index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1\" \/>\n<link rel=\"canonical\" href=\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/\" \/>\n<meta property=\"og:locale\" content=\"en_US\" \/>\n<meta property=\"og:type\" content=\"article\" \/>\n<meta property=\"og:title\" content=\"CocoaPods, GoogleMaps, and GitHub Restrictions\" \/>\n<meta property=\"og:description\" content=\"CocoaPods, GoogleMaps, and GitHub restrictions that occur. Learn about our decisions and possible solutions to the issues that might happen in the process.\" \/>\n<meta property=\"og:url\" content=\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/\" \/>\n<meta property=\"og:site_name\" content=\"Intellectsoft Blog\" \/>\n<meta property=\"article:published_time\" content=\"2016-02-12T17:42:25+00:00\" \/>\n<meta property=\"article:modified_time\" content=\"2019-10-08T14:57:15+00:00\" \/>\n<meta property=\"og:image\" content=\"https:\/\/www.intellectsoft.net\/blog\/wp-content\/uploads\/panda_stanfy1-2-copy.jpg\" \/>\n\t<meta property=\"og:image:width\" content=\"2560\" \/>\n\t<meta property=\"og:image:height\" content=\"1440\" \/>\n<meta name=\"twitter:card\" content=\"summary\" \/>\n<script type=\"application\/ld+json\" class=\"yoast-schema-graph\">{\"@context\":\"https:\/\/schema.org\",\"@graph\":[{\"@type\":\"WebSite\",\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/#website\",\"url\":\"https:\/\/www.intellectsoft.net\/blog\/\",\"name\":\"Intellectsoft Blog\",\"description\":\"\",\"potentialAction\":[{\"@type\":\"SearchAction\",\"target\":\"https:\/\/www.intellectsoft.net\/blog\/?s={search_term_string}\",\"query-input\":\"required name=search_term_string\"}],\"inLanguage\":\"en-US\"},{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/#primaryimage\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/www.intellectsoft.net\/blog\/wp-content\/uploads\/panda_stanfy1-2-copy.jpg\",\"width\":2560,\"height\":1440},{\"@type\":\"WebPage\",\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/#webpage\",\"url\":\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/\",\"name\":\"CocoaPods, GoogleMaps, and GitHub Restrictions\",\"isPartOf\":{\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/#website\"},\"primaryImageOfPage\":{\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/#primaryimage\"},\"datePublished\":\"2016-02-12T17:42:25+00:00\",\"dateModified\":\"2019-10-08T14:57:15+00:00\",\"author\":{\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/#\/schema\/person\/934d88e6448434bc0f87550678a8637e\"},\"description\":\"CocoaPods, GoogleMaps, and GitHub restrictions that occur. Learn about our decisions and possible solutions to the issues that might happen in the process.\",\"inLanguage\":\"en-US\",\"potentialAction\":[{\"@type\":\"ReadAction\",\"target\":[\"https:\/\/www.intellectsoft.net\/blog\/cocoapods-googlemaps-and-github-restrictions\/\"]}]},{\"@type\":\"Person\",\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/#\/schema\/person\/934d88e6448434bc0f87550678a8637e\",\"name\":\"Anastasiia Hibaieva\",\"image\":{\"@type\":\"ImageObject\",\"@id\":\"https:\/\/www.intellectsoft.net\/blog\/#personlogo\",\"inLanguage\":\"en-US\",\"url\":\"https:\/\/secure.gravatar.com\/avatar\/5e777493cd8ae0902fee5b35c44765ce?s=96&d=mm&r=g\",\"caption\":\"Anastasiia Hibaieva\"}}]}<\/script>\n<!-- \/ Yoast SEO plugin. -->","_links":{"self":[{"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/posts\/11679"}],"collection":[{"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/users\/63"}],"replies":[{"embeddable":true,"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/comments?post=11679"}],"version-history":[{"count":0,"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/posts\/11679\/revisions"}],"wp:featuredmedia":[{"embeddable":true,"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/media\/14673"}],"wp:attachment":[{"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/media?parent=11679"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/categories?post=11679"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/www.intellectsoft.net\/blog\/wp-json\/wp\/v2\/tags?post=11679"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}